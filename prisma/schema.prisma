generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  AGENT
  MANAGER
  SUPER_ADMIN
  ADMIN
}

enum BreakStatus {
  ONGOING
  ENDED
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(AGENT)
  isOnline  Boolean  @default(false)
  mustChangePassword Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  breakSessions BreakSession[]
  createdAgents User[] @relation("CreatedAgents") // For managers creating agents
  createdBy     User?  @relation("CreatedAgents", fields: [createdById], references: [id])
  createdById   Int?
  lastLogin     DateTime?
  allowedBreaks BreakType[] @relation("UserAllowedBreaks")
}

model BreakType {
  id        Int      @id @default(autoincrement())
  name      String
  duration  Int      // Duration in seconds
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  breakSessions BreakSession[]
  allowedUsers  User[]       @relation("UserAllowedBreaks")
}

model BreakSession {
  id                Int         @id @default(autoincrement())
  userId            Int
  breakTypeId       Int
  startTime         DateTime    @default(now())
  endTime           DateTime?
  expectedEndTime   DateTime
  status            BreakStatus @default(ONGOING)
  violationDuration Int?        // In seconds, null if no violation
  
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  breakType BreakType @relation(fields: [breakTypeId], references: [id])
}
